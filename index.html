<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <title>APIConnect - A simplified Javascript interface for working with APIs</title>
  <link rel="stylesheet" href="stylesheets/sh_custom.css" type="text/css" />
  <link rel="stylesheet" href="stylesheets/main.css" type="text/css" />
</head>

<body spellcheck="false">

  <div id="container">

    <div id="main_header">

      <div class="buttons">
        <a id="docs" href="docs.html" title="#specs">Docs</a>
        <a id="github" href="https://github.com/andrewplummer/APIConnect">Github</a>
        <a id="download" href="https://raw.github.com/andrewplummer/APIConnect/master/lib/apiconnect.js" title="#specs">Download</a>
      </div>

      <div id="share">
        <div id="google">
          <g:plusone size="tall"></g:plusone>
        </div>
        <div id="twitter">
          <a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical">Tweet</a>
          <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
        </div>
        <div id="facebook">
          <div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#appId=192585364124839&amp;xfbml=1"></script><fb:like href="" send="false" layout="box_count" width="50" show_faces="true" font=""></fb:like>
       </div>
      </div>

      <h1 id="logo">
        <img src="images/logo.png" alt="APIConnect" />
      </h1>
    </div>

    <p class="first">APIConnect is a Javascript class that provides a simple way to interact with APIs, specifically those hosted on other domains. Setup is as simple as creating the instance, specifying the domain, connecting the route, and running it. APIConnect works in all major browsers with jQuery as its only dependency, and is now available on <a href="http://search.npmjs.org/#/APIConnect">npm</a>!</p>

<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect();
api.domain('graph.facebook.com');
api.connect(':object_id');
api.getObject({ object_id: page_id }).then(displayJSON);
</div>

<h2>Connecting Routes</h2>
<p>Any route can have any number of params in the base URL (contexts). These contexts are always optional, and will only be added if they exist in the params object when the route is called.</p>
<p>Once the route is connected, calling it is as simple as calling a camelized method on the instance. When making the call, the first argument is the params object, and the second argument is for "options". Here you can specify options for both APIConnect as well as any valid option for jQuery.ajax, meaning all standard callbacks will work.</p>
<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect('graph.facebook.com');
api.connect(':object_id');
api.getObject({ object_id: page_id }, { complete: displayJSON });
</div>
<p>API calls also pass back jQuery deferred objects, so these can be used as well.</p>
<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect('graph.facebook.com');
api.connect(':object_id');
api.getObject({ object_id: page_id }).then(displayJSON);
</div>
<p>Both params or options can also be made "global" or instance-wide by specifying them directly on the instance. They will be applied to all routes (but can be overwritten with local params/options).</p>
<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect('graph.facebook.com');
api.params({ access_token: app_access_token });
api.options({ complete: displayJSON });
api.connect(':object_id');
api.getObject({ object_id: page_id });
</div>
<p>The 4 main HTTP verbs, "GET", "POST", "PUT", and "DELETE", are allowed in routes, and map to humanized verbs "get", "create", "update", and "destroy", respectively. "GET" is the implied default.</p>
<p>This code is actually posting to a <a href="http://www.facebook.com/pages/APIConnect-Test/339240909450916" target="_blank">live Facebook page</a> through APIConnect!</p>
<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect('graph.facebook.com');
api.param('access_token', app_access_token);
api.connect('POST :id/feed');

var message = "Hello from APIConnect! It's " + new Date().toString();
api.createFeed({ id: page_id, message: message }, { complete: displayJSON });
</div>
<p>The camelized method name is a combination of the humanied HTTP verb and the last non-parameter fragment in the route. In the examples, a "non-parameter fragment" is <span class="code">photos</span> as opposed to a "parameter fragment" <span class="code">:photo_type</span>, etc. If no non-parameter fragments exist, the last parameter fragment will be used instead.</p>
<p>If this is still not good enough, the entire method name can easily be overridden using the <span class="code">as</span> option when connecting the route.</p>
<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect('graph.facebook.com');
api.connect(':object_id/photos/:photo_type', { as: 'getImages' });
api.getImages({ object_id: page_id, photo_type: 'profile' }, { complete: displayJSON });
</div>
<p>Params can also be "burned in" when connecting routes, allowing even more expressive statements.</p>
<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect('graph.facebook.com');
var p = { photo_type: 'profile' };
api.connect(':object_id/photos/:photo_type', { params: p, as: 'getProfileImages' });
api.getProfileImages({ object_id: page_id }, { complete: displayJSON });
</div>
<p>"resource" serves as a shortcut to all 4 HTTP verbs.</p>
<div class="multiline code_example inactive">
api.resource('member');

api.getMember();     <span class="dim">// GET     http://domain/member.json</span>
api.createMember();  <span class="dim">// POST    http://domain/member.json</span>
api.updateMember();  <span class="dim">// PUT     http://domain/member.json</span>
api.destroyMember(); <span class="dim">// DELETE  http://domain/member.json</span>
</div>
<p>Members of these routes can be limited using <span class="code">only</span> and <span class="code">exclude</span>.</p>
<div class="multiline code_example inactive">
api.resource('member', { only: 'show,update' });

api.getMember();     <span class="dim">// GET     http://domain/member.json</span>
api.updateMember();  <span class="dim">// PUT     http://domain/member.json</span>

api.resource('member', { exclude: 'show,update' });

api.createMember();  <span class="dim">// POST    http://domain/member.json</span>
api.destroyMember(); <span class="dim">// DELETE  http://domain/member.json</span>
</div>
<p>If a resource is a collection, passing <span class="code">collection: true</span> in the options for "resource" will create standard collection routes including an "index" method.</p>
<div class="multiline code_example inactive">
api.resource('status', { collection: true });

api.getStatus();              <span class="dim">// GET     http://domain/status.json</span>
api.getStatus({ id: 3});      <span class="dim">// GET     http://domain/status/3.json</span>
api.createStatus();           <span class="dim">// POST    http://domain/status.json</span>
api.updateStatus({ id: 3 });  <span class="dim">// PUT     http://domain/status/3.json</span>
api.destroyStatus({ id: 3 }); <span class="dim">// DELETE  http://domain/status/3.json</span>
</div>
<p>If <span class="code">collection</span> is omitted, it will attempt to be intelligently detected by the pluralization of the resource passed.</p>
<div class="multiline code_example inactive">
api.resource('members');

api.getMembers();              <span class="dim">// GET     http://domain/members.json</span>
api.getMembers({ id: 3});      <span class="dim">// GET     http://domain/members/3.json</span>
api.createMembers();           <span class="dim">// POST    http://domain/members.json</span>
api.updateMembers({ id: 3 });  <span class="dim">// PUT     http://domain/members/3.json</span>
api.destroyMembers({ id: 3 }); <span class="dim">// DELETE  http://domain/members/3.json</span>
</div>
<h2>Options</h2>
<p>Options are passed in when making the call, and can be overridden there, however instance-wide options are set on the object itself.</p>
<div class="multiline code_example inactive">
api.option('headers', { myCustomHeaderName: 'myCustomHeaderValue' });

api.options({
  statusCode: {
    404: function() {
      alert('Page not found!');
    }
  }
});
</div>
<p>Additionally the basic options "domain", "protocol", "port", "timeout", "cors", and "jsonp" can be set directly on the instance. When setting options, the instance itself will be returned, allowing method-chaining just like jQuery objects.</p>
<div class="multiline code_example inactive">
api.domain('localhost');
api.port('4000');
api.cors(false);
</div>
<p>All such options are both getters and setters. Passing no arguments will return their current value.</p>
<div class="multiline code_example inactive">
api.domain();     // "localhost"
api.port('4000'); // "4000"
api.cors(false);  // false
</div>

<h2>Cross-domain ajax and JSONP</h2>
<p>APIConnect will by default attempt to use CORS (cross-origin resource sharing). For this to work, the API you're working with needs to be sending the correct response headers. If your calls are returning a 200-level response but no data is coming in, most likely CORS is not supported and needs to be disabled.</p>
<p>Turning off CORS support will fall back to JSONP, which also needs to be enabled on the API side.</p>
<div class="multiline code_example console no_autorun show_live">
var api = new APIConnect('graph.facebook.com');
api.cors(false);
api.connect(':object_id');
api.getObject({ object_id: page_id }).then(displayJSON);
</div>
<p>Certain older browsers (earlier versions of IE, etc) do not support CORS. In this case, APIConnect will fall back to JSONP <em>if</em> the request is on another domain. This means that if both CORS and JSONP are enabled on the API server, all browsers will work with APIConnect of the box. However if JSONP is not supported, the request must be on the same domain or it will fail outright.</p>

<h2>Advanced</h2>
<p>If you have many routes with the same context you can hold onto it so as not to repeat yourself.</p>
<div class="multiline code_example inactive">
api.context(':user', function() {
  api.connect('tasks');
  api.connect('images');
  api.connect('profile');
  // ...
});
</div>
<p>Results from an api call can be cached locally for the duration of the page load. Only GET requests will be cached and only if the params match exactly. If cached, the calls will resolve successfully immediately.</p>
<div class="multiline code_example console no_autorun show_live">
api = api || new APIConnect('graph.facebook.com');
api.connect(':object_id');
api.getObject({ object_id: page_id }, { cache: true }).then(displayJSON);
</div>
</div>
  <div id="json_stage">
    <div class="route"></div>
    <div class="output"></div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js?20120127"></script>
  <script src="https://raw.github.com/andrewplummer/APIConnect/master/lib/apiconnect.js"></script>
  <!--<script src="lib/apiconnect.js"></script>-->
  <script src="javascripts/sh_main.min.js"></script>
  <script src="javascripts/sh_javascript.min.js"></script>
  <script src="javascripts/code.js"></script>
  <script src="javascripts/beautify.js"></script>
  <script type="text/javascript">

    var api;
    var app_id = '189795071129074';
    var page_id = '339240909450916';
    var app_access_token = 'AAACsnhvLdfIBAJZCCgC14WSKQYcef9lCapTzGspect7bOupTHbsko9tmLZC1H1y3TOZCDFFZBCEfkpD6OZBII4wV20bPZA5HdSWpOz9CKeBQZDZD';

    stage = $('#json_stage');

    $('.code_example').activateCodeExample();
    $(document).click(hideJsonStage);
    $(document).ajaxStart(function() {
      $('.output', stage).css('visibility', 'hidden');
      $('.route', stage).empty();
      stage.addClass('loading');
    });
    $(document).ajaxComplete(function(event, sm, xhr) {
        $('.output', stage).css('visibility', 'visible');
        stage.removeClass('loading');
        $('#json_stage .route').text(xhr.type + ' ' + xhr.url);
    });
    $('#json_stage').click(function() { return false; });
    $('.actions .run').click(function() { return false; });
    function displayJSON(json) {
      if(json.responseText) {
        json = JSON.parse(json.responseText);
      }
      var stringified = window.JSON ? js_beautify(JSON.stringify(json)) : json.toString();
      $('#json_stage .output').text(stringified);
      showJsonStage();
    }
    var stageIsIn = false;

    function showJsonStage() {
      if(stageIsIn) return;
      stage.css('left', -stage.width() - 40);
      stage.stop(true, true).show().animate({ left: 0 }, { duration: 200, easing: 'swing' });
      stageIsIn = true;
    }

    function hideJsonStage() {
      stage.stop(true, true).animate({ left: -stage.width() - 40 }, { duration: 200, easing: 'swing', complete: function(){
        stageIsIn = false;
        stage.hide();
      }});
    }

    // Patching for JSONP URL detection
    var $AJAX = $.ajax;
    $.ajax = function(url, o) {
      var deferred = $AJAX.apply(this, arguments);
      if(o.dataType == 'jsonp') {
        $(document).trigger('ajaxStart', []);
        deferred.always(function(data, state, xhr) {
          $(document).trigger('ajaxComplete', [data, this]);
        });
      }
      return deferred;
    }

  </script>
  <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
</body>
</html>
